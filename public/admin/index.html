<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <title>Content Manager - AR Alphaya Jewellery</title>
  </head>
  <body>
    <script>
      // Manual init flag - prevents auto-init before we configure the backend
      window.CMS_MANUAL_INIT = true;
    </script>
    
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    
    <script>
      // Fetch token from our API and inject it for CMS
      async function initCMS() {
        try {
          // Get GitHub token from protected endpoint
          const response = await fetch('/api/admin/auth?provider=github');
          if (!response.ok) throw new Error('Failed to authenticate');
          
          const { token } = await response.json();
          if (!token) throw new Error('No token received');
          
          // Store token in localStorage for Decap CMS GitHub backend
          localStorage.setItem('github-token', token);
          
          // Initialize CMS
          if (window.CMS) {
            window.CMS.init();
          }
        } catch (error) {
          console.error('Init error:', error);
          document.body.innerHTML = `
            <div style="padding: 40px; font-family: sans-serif; max-width: 600px; margin: 0 auto;">
              <h1>⚠️ Authentication Error</h1>
              <p style="color: #666;">${error.message}</p>
              <p>Make sure you're logged in with Basic Auth credentials.</p>
              <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; cursor: pointer;">
                Retry
              </button>
            </div>
          `;
        }
      }
      
      if (window.CMS) {
        initCMS();
      }
    </script>
  </body>
</html>